
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the system, defining their identity and permissions.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The unique identifier from the authentication provider (Firebase Auth UID)."
        },
        "displayName": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address, used for login.",
          "format": "email"
        },
        "permissions": {
          "type": "object",
          "description": "A map of granular, module-based permissions.",
          "properties": {
            "dashboard": { "$ref": "#/entities/ModulePermissions" },
            "empresas": { "$ref": "#/entities/ModulePermissions" },
            "societario": { "$ref": "#/entities/ModulePermissions" },
            "processos": { "$ref": "#/entities/ModulePermissions" },
            "obrigacoes": { "$ref": "#/entities/ModulePermissions" },
            "fiscal": { "$ref": "#/entities/ModulePermissions" },
            "documentos": { "$ref": "#/entities/ModulePermissions" },
            "financeiro": { "$ref": "#/entities/ModulePermissions" },
            "usuarios": { "$ref": "#/entities/ModulePermissions" }
          }
        },
        "photoURL": {
          "type": "string",
          "format": "uri",
          "description": "URL of the user's profile picture."
        }
      },
      "required": [ "uid", "displayName", "email", "permissions" ]
    },
    "ModulePermissions": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "ModulePermissions",
        "type": "object",
        "description": "Defines the CRUD permissions for a single module.",
        "properties": {
            "read": { "type": "boolean" },
            "create": { "type": "boolean" },
            "update": { "type": "boolean" },
            "delete": { "type": "boolean" }
        },
        "required": ["read", "create", "update", "delete"]
    },
     "Company": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Company",
      "type": "object",
      "description": "Represents a company served by the accounting firm.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Company entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the company."
        },
        "cnpj": {
          "type": "string",
          "description": "CNPJ of the company."
        },
        "cnae": {
          "type": "string",
          "description": "National Classification of Economic Activities (CNAE) code of the company."
        },
        "address": {
          "type": "string",
          "description": "Full address of the company."
        },
        "taxRegime": {
          "type": "string",
          "description": "Tax regime of the company (e.g., Simples Nacional, Lucro Presumido)."
        },
        "assessmentRegime": {
          "type": "string",
          "description": "Assessment regime of the company."
        },
        "status": {
          "type": "string",
          "description": "Registration status of the company (e.g., Apto, Inapto, Baixado)."
        },
        "startDate": {
          "type": "string",
          "description": "Date when the company started its activities.",
          "format": "date-time"
        },
        "mainContactId": {
          "type": "string",
          "description": "Reference to User. Main contact person within the company. (Relationship: User 1:N Company)"
        },
        "certificateA1Validity": {
          "type": "string",
          "description": "Expiration date of the A1 digital certificate.",
          "format": "date"
        },
        "certificateA1Url": {
          "type": "string",
          "format": "uri",
          "description": "URL of the A1 certificate file in Firebase Storage."
        },
        "members": {
          "type": "object",
          "description": "Map of user UIDs to their roles within this company for access control. Example: { 'uid1': 'admin', 'uid2': 'viewer' }."
        },
        "internalEmail": {
          "type": "string",
          "format": "email",
          "description": "Internal contact email for the company."
        },
        "internalPhone": {
          "type": "string",
          "description": "Internal contact phone number for the company."
        },
        "whatsappGroup": {
          "type": "string",
          "description": "Internal contact for the company's WhatsApp group."
        }
      },
      "required": [
        "id",
        "name",
        "cnpj",
        "taxRegime",
        "status",
        "startDate"
      ]
    },
     "Partner": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Partner",
      "type": "object",
      "description": "Represents a partner or administrator associated with one or more companies.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Partner entity, usually the CPF."
        },
        "name": {
          "type": "string",
          "description": "Full name of the partner."
        },
        "cpf": {
          "type": "string",
          "description": "CPF of the partner."
        },
        "qualification": {
          "type": "string",
          "description": "The partner's qualification or role in the company (e.g., Sócio-Administrador)."
        },
        "hasECPF": {
          "type": "boolean",
          "description": "Indicates if the partner has an active E-CPF."
        },
        "ecpfValidity": {
          "type": "string",
          "format": "date",
          "description": "Expiration date of the E-CPF certificate."
        },
        "ecpfUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL of the E-CPF certificate file in Firebase Storage."
        },
        "govBrLogin": {
          "type": "string",
          "description": "Partner's login for the GOV.BR portal (stored encrypted)."
        },
        "govBrPassword": {
          "type": "string",
          "description": "Partner's password for the GOV.BR portal (stored encrypted)."
        },
        "associatedCompanies": {
          "type": "array",
          "description": "List of company names the partner is associated with.",
          "items": {
            "type": "string"
          }
        },
        "otherData": {
          "type": "string",
          "description": "Field for other relevant partner data."
        }
      },
      "required": [
        "id",
        "name",
        "cpf",
        "hasECPF"
      ]
    },
     "TaxObligation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TaxObligation",
      "type": "object",
      "description": "Represents a tax obligation for a specific company, including its history and related documents.",
      "properties": {
        "id": { "type": "string" },
        "companyId": { "type": "string" },
        "companyName": { "type": "string" },
        "nome": { "type": "string" },
        "categoria": { "type": "string", "enum": ["Fiscal", "Contábil", "DP", "Outros"] },
        "periodicidade": { "type": "string", "enum": ["Mensal", "Anual", "Eventual"] },
        "periodo": { "type": "string" },
        "dataVencimento": { "type": "string", "format": "date-time" },
        "dataEntrega": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["Pendente", "Em Andamento", "Entregue", "Atrasada", "Cancelada"] },
        "responsavelId": { "type": "string" },
        "responsavelNome": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "companyId", "companyName", "nome", "categoria", "periodicidade", "periodo", "dataVencimento", "status", "createdAt", "updatedAt"]
    },
    "CorporateProcess": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CorporateProcess",
      "type": "object",
      "description": "Represents a corporate process related to opening, altering, or closing a company.",
      "properties": {
        "id": { "type": "string" },
        "companyId": { "type": "string" },
        "companyName": { "type": "string" },
        "processType": { "type": "string" },
        "startDate": { "type": "string", "format": "date-time" },
        "protocolDate": { "type": "string", "format": "date-time" },
        "completionDate": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["Aguardando Documentação", "Em Análise", "Em Preenchimento", "Protocolado", "Em Andamento Externo", "Aguardando Cliente", "Aguardando Órgão", "Concluído", "Cancelado"] },
        "priority": { "type": "string", "enum": ["Baixa", "Média", "Alta"] },
        "notes": { "type": "string" }
      },
      "required": ["id", "companyId", "companyName", "processType", "startDate", "status", "priority"]
    },
    "Invoice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Invoice",
      "type": "object",
      "description": "Represents a monthly fee or invoice for a company.",
      "properties": {
        "id": { "type": "string" },
        "companyId": { "type": "string" },
        "companyName": { "type": "string" },
        "referencePeriod": { "type": "string", "pattern": "^\\d{4}-\\d{2}$" },
        "amount": { "type": "number" },
        "dueDate": { "type": "string", "format": "date" },
        "paymentDate": { "type": "string", "format": "date" },
        "status": { "type": "string", "enum": ["Pendente", "Paga", "Atrasada", "Cancelada"] }
      },
      "required": ["id", "companyId", "companyName", "referencePeriod", "amount", "dueDate", "status"]
    },
    "FiscalDocument": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FiscalDocument",
      "type": "object",
      "description": "Represents a fiscal document like an invoice or tax ledger.",
      "properties": {
        "id": { "type": "string" },
        "companyId": { "type": "string" },
        "companyName": { "type": "string" },
        "companyCnpj": { "type": "string" },
        "documentType": { "type": "string", "enum": ["Livro de Entrada", "Livro de Saída", "Nota Fiscal de Entrada", "Nota Fiscal de Saída"] },
        "status": { "type": "string", "enum": ["Ativa", "Cancelada", "Inutilizada", "Denegada", "Rejeitada"] },
        "uploadedAt": { "type": "string", "format": "date-time" },
        "fileUrl": { "type": "string", "format": "uri" },
        "competencia": { "type": "string" }
      },
      "required": ["id", "companyId", "companyName", "documentType", "status", "uploadedAt", "fileUrl", "competencia"]
    },
    "Note": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Note",
      "type": "object",
      "description": "Represents a single note or comment attached to another entity.",
      "properties": {
        "id": { "type": "string" },
        "text": { "type": "string" },
        "userId": { "type": "string" },
        "userName": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "text", "userId", "userName", "createdAt"]
    },
    "XmlStatus": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "XmlStatus",
      "type": "object",
      "description": "Tracks the XML submission status for a company for a given month/year.",
      "properties": {
        "id": { "type": "string", "description": "Composite key: {companyId}_{month}_{year}" },
        "companyId": { "type": "string" },
        "month": { "type": "number" },
        "year": { "type": "number" },
        "status": { "type": "string", "enum": ["Pendente", "Aguardando Reenvio", "Enviado"] }
      },
      "required": ["id", "companyId", "month", "year", "status"]
    }
  },
  "auth": {
    "providers": ["password"]
  },
  "firestore": {
    "structure": [
       {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": { "$ref": "#/entities/User" },
          "description": "Stores user profiles. This is the single source of truth for permissions."
        }
      },
      {
        "path": "/companies/{companyId}",
        "definition": {
          "entityName": "Company",
          "schema": { "$ref": "#/entities/Company" },
          "description": "Collection for all client companies."
        }
      },
       {
        "path": "/companies/{companyId}/certificates/{certificateId}",
        "definition": {
          "description": "Subcollection to store certificate details like validity and URL."
        }
      },
      {
        "path": "/companies/{companyId}/taxObligations/{taxObligationId}",
        "definition": {
          "entityName": "TaxObligation",
          "schema": { "$ref": "#/entities/TaxObligation" },
          "description": "Subcollection to store tax obligations for a specific company."
        }
      },
      {
        "path": "/companies/{companyId}/documents/{documentId}",
        "definition": {
          "entityName": "Document",
          "schema": {
            "$ref": "#/entities/Document"
          },
          "description": "Subcollection to store documents related to a specific company."
        }
      },
      {
        "path": "/partners/{partnerId}",
        "definition": {
          "entityName": "Partner",
          "schema": { "$ref": "#/entities/Partner" },
          "description": "Collection to store partner and administrator information."
        }
      },
      {
        "path": "/invoices/{invoiceId}",
        "definition": {
          "entityName": "Invoice",
          "schema": { "$ref": "#/entities/Invoice" },
          "description": "Collection for all financial invoices."
        }
      },
      {
        "path": "/fiscalDocuments/{documentId}",
        "definition": {
          "entityName": "FiscalDocument",
          "schema": { "$ref": "#/entities/FiscalDocument" },
          "description": "Collection for all fiscal documents."
        }
      },
      {
        "path": "/fiscalDocuments/{documentId}/notes/{noteId}",
        "definition": {
            "entityName": "Note",
            "schema": { "$ref": "#/entities/Note" },
            "description": "Subcollection for notes on a fiscal document."
        }
      },
      {
        "path": "/xmlStatus/{statusId}",
        "definition": {
          "entityName": "XmlStatus",
          "schema": { "$ref": "#/entities/XmlStatus" },
          "description": "Collection to track XML submission status."
        }
      },
       {
        "path": "/corporateProcesses/{processId}",
        "definition": {
          "entityName": "CorporateProcess",
          "schema": { "$ref": "#/entities/CorporateProcess" },
          "description": "Collection for all corporate processes."
        }
      },
      {
        "path": "/corporateProcesses/{processId}/history/{historyId}",
        "definition": {
          "description": "Subcollection to store the history of a corporate process."
        }
      },
      {
        "path": "/corporateProcesses/{processId}/attachments/{attachmentId}",
        "definition": {
          "description": "Subcollection to store attachments for a corporate process."
        }
      }
    ]
  }
}
