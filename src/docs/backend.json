{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the system, defining their identity and permissions.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The unique identifier from the authentication provider (Firebase Auth UID)."
        },
        "displayName": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address, used for login.",
          "format": "email"
        },
        "roleId": {
          "type": "string",
          "description": "The primary role of the user, determining their base level of access.",
          "enum": ["owner", "admin", "contador", "usuario"]
        },
        "companyIds": {
            "type": "array",
            "description": "A list of company IDs the user is permitted to access. Empty for admins/owners who have global access.",
            "items": { "type": "string" }
        },
        "isAdmin": {
            "type": "boolean",
            "description": "Flag indicating if the user has administrative privileges over users and settings."
        },
        "canFinance": {
            "type": "boolean",
            "description": "Flag indicating if the user has access to the financial module."
        },
        "photoURL": {
          "type": "string",
          "format": "uri",
          "description": "URL of the user's profile picture."
        },
        "createdAt": {
            "type": "string",
            "format": "date-time"
        },
        "updatedAt": {
            "type": "string",
            "format": "date-time"
        }
      },
      "required": [
        "userId",
        "displayName",
        "email",
        "roleId",
        "isAdmin",
        "canFinance",
        "createdAt",
        "updatedAt"
      ]
    },
     "Company": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Company",
      "type": "object",
      "description": "Represents a company served by the accounting firm.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Company entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the company."
        },
        "cnpj": {
          "type": "string",
          "description": "CNPJ of the company."
        },
        "cnae": {
          "type": "string",
          "description": "National Classification of Economic Activities (CNAE) code of the company."
        },
        "address": {
          "type": "string",
          "description": "Full address of the company."
        },
        "taxRegime": {
          "type": "string",
          "description": "Tax regime of the company (e.g., Simples Nacional, Lucro Presumido)."
        },
        "assessmentRegime": {
          "type": "string",
          "description": "Assessment regime of the company."
        },
        "status": {
          "type": "string",
          "description": "Registration status of the company (e.g., Apto, Inapto, Baixado)."
        },
        "startDate": {
          "type": "string",
          "description": "Date when the company started its activities.",
          "format": "date-time"
        },
        "mainContactId": {
          "type": "string",
          "description": "Reference to User. Main contact person within the company. (Relationship: User 1:N Company)"
        },
        "certificateA1Validity": {
          "type": "string",
          "description": "Expiration date of the A1 digital certificate.",
          "format": "date"
        },
        "certificateA1Url": {
          "type": "string",
          "format": "uri",
          "description": "URL of the A1 certificate file in Firebase Storage."
        }
      },
      "required": [
        "id",
        "name",
        "cnpj",
        "taxRegime",
        "status",
        "startDate"
      ]
    },
     "Partner": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Partner",
      "type": "object",
      "description": "Represents a partner or administrator associated with one or more companies.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Partner entity, usually the CPF."
        },
        "name": {
          "type": "string",
          "description": "Full name of the partner."
        },
        "cpf": {
          "type": "string",
          "description": "CPF of the partner."
        },
        "qualification": {
          "type": "string",
          "description": "The partner's qualification or role in the company (e.g., Sócio-Administrador)."
        },
        "hasECPF": {
          "type": "boolean",
          "description": "Indicates if the partner has an active E-CPF."
        },
        "ecpfValidity": {
          "type": "string",
          "format": "date",
          "description": "Expiration date of the E-CPF certificate."
        },
        "ecpfUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL of the E-CPF certificate file in Firebase Storage."
        },
        "govBrLogin": {
          "type": "string",
          "description": "Partner's login for the GOV.BR portal (stored encrypted)."
        },
        "govBrPassword": {
          "type": "string",
          "description": "Partner's password for the GOV.BR portal (stored encrypted)."
        },
        "associatedCompanies": {
          "type": "array",
          "description": "List of company names the partner is associated with.",
          "items": {
            "type": "string"
          }
        },
        "otherData": {
          "type": "string",
          "description": "Field for other relevant partner data."
        }
      },
      "required": [
        "id",
        "name",
        "cpf",
        "hasECPF"
      ]
    },
     "TaxObligation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TaxObligation",
      "type": "object",
      "description": "Represents a tax obligation for a specific company, including its history and related documents.",
      "properties": {
        "id": { "type": "string" },
        "companyId": { "type": "string" },
        "companyName": { "type": "string" },
        "nome": { "type": "string" },
        "categoria": { "type": "string", "enum": ["Fiscal", "Contábil", "DP", "Societário"] },
        "periodicidade": { "type": "string", "enum": ["Mensal", "Trimestral", "Anual", "Eventual"] },
        "periodo": { "type": "string" },
        "dataVencimento": { "type": "string", "format": "date-time" },
        "dataEntrega": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["Pendente", "Em Andamento", "Entregue", "Atrasada"] },
        "responsavelId": { "type": "string" },
        "responsavelNome": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "companyId", "companyName", "nome", "categoria", "periodicidade", "periodo", "dataVencimento", "status", "createdAt", "updatedAt"]
    },
    "CorporateProcess": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CorporateProcess",
      "type": "object",
      "description": "Represents a corporate process related to opening, altering, or closing a company.",
      "properties": {
        "id": { "type": "string" },
        "companyId": { "type": "string" },
        "companyName": { "type": "string" },
        "processType": { "type": "string" },
        "startDate": { "type": "string", "format": "date-time" },
        "protocolDate": { "type": "string", "format": "date-time" },
        "status": { "type": "string" }
      },
      "required": ["id", "companyId", "companyName", "processType", "startDate", "status"]
    },
    "Invoice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Invoice",
      "type": "object",
      "description": "Represents a monthly fee or invoice for a company.",
      "properties": {
        "id": { "type": "string" },
        "companyId": { "type": "string" },
        "companyName": { "type": "string" },
        "referencePeriod": { "type": "string", "pattern": "^\\d{4}-\\d{2}$" },
        "amount": { "type": "number" },
        "dueDate": { "type": "string", "format": "date" },
        "paymentDate": { "type": "string", "format": "date" },
        "status": { "type": "string", "enum": ["Pendente", "Paga", "Atrasada", "Cancelada"] }
      },
      "required": ["id", "companyId", "companyName", "referencePeriod", "amount", "dueDate", "status"]
    }
  },
  "auth": {
    "providers": ["password"]
  },
  "firestore": {
    "structure": [
       {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": { "$ref": "#/entities/User" },
          "description": "Stores user profiles. This is the single source of truth for permissions."
        }
      },
      {
        "path": "/companies/{companyId}",
        "definition": {
          "entityName": "Company",
          "schema": { "$ref": "#/entities/Company" },
          "description": "Collection for all client companies."
        }
      },
      {
        "path": "/partners/{partnerId}",
        "definition": {
          "entityName": "Partner",
          "schema": { "$ref": "#/entities/Partner" },
          "description": "Collection to store partner and administrator information."
        }
      },
      {
        "path": "/taxObligations/{taxObligationId}",
        "definition": {
          "entityName": "TaxObligation",
          "schema": { "$ref": "#/entities/TaxObligation" },
          "description": "Main collection for all tax obligations."
        }
      },
       {
        "path": "/corporateProcesses/{processId}",
        "definition": {
          "entityName": "CorporateProcess",
          "schema": { "$ref": "#/entities/CorporateProcess" },
          "description": "Main collection for all corporate processes."
        }
      },
      {
        "path": "/invoices/{invoiceId}",
        "definition": {
          "entityName": "Invoice",
          "schema": { "$ref": "#/entities/Invoice" },
          "description": "Collection for all financial invoices."
        }
      }
    ]
  }
}
